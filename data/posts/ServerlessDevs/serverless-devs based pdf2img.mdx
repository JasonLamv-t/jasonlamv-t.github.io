---
title: Serverless-Devs ÂÆûË∑µ‚Äî‚ÄîÂü∫‰∫é GhostScript ÁöÑ PDF ËΩ¨ JPG
date: '2021-7-16'
tags: ['NodeJS', 'Serverless', 'Serverless-Devs', 'Aliyun', 'PDF2IMG']
summary: ËØ•È°πÁõÆÊòØÂü∫‰∫é GhostScript ÁöÑ PDF ËΩ¨ JPG Â∑•ÂÖ∑ÔºåÂÄüÂä© Serverless-Devs Â∑•ÂÖ∑ËøõË°å‰æùËµñÂÆâË£ÖÂπ∂ÈÉ®ÁΩ≤Âà∞ÈòøÈáå‰∫ëÂáΩÊï∞ËÆ°ÁÆóÔºåÊòØ‰∏Ä‰∏™ serverless ÁöÑÁÆÄÂçïÁ§∫‰æã„ÄÇ
---

ËØ•È°πÁõÆÊòØÂü∫‰∫é GhostScript ÁöÑ PDF ËΩ¨ JPG Â∑•ÂÖ∑ÔºåÂÄüÂä©[Serverless-Devs](https://github.com/Serverless-Devs/Serverless-Devs/blob/master/readme_zh.md)Â∑•ÂÖ∑ËøõË°å‰æùËµñÂÆâË£ÖÂπ∂ÈÉ®ÁΩ≤Âà∞ÈòøÈáå‰∫ëÂáΩÊï∞ËÆ°ÁÆóÔºåÊòØ‰∏Ä‰∏™ serverless ÁöÑÁÆÄÂçïÁ§∫‰æã„ÄÇ

## ÂºÄÂßã‰πãÂâç

### Serverless-Devs

Â¶ÇÊûúÊÇ®ÁöÑÂºÄÂèëÁéØÂ¢ÉÊ≤°Êúâ Serverless-DevsÔºåÂ¶ÇÊûúÊÇ®ÁöÑÂºÄÂèëÁéØÂ¢ÉÂÖ∑Â§á[npm](https://www.npmjs.com/)ÔºåÂèØÊâßË°å‰ª•‰∏ãÂëΩ‰ª§ËøõË°åÂÆâË£ÖÔºö

```bash
npm install  @serverless-devs/s -g
```

ÊàñËÄÖ ÈÄöËøá [yarn](https://yarnpkg.com/) ËøõË°åÂÆâË£Ö

```bash
yarn global add  @serverless-devs/s
```

Êõ¥Â§öÂÜÖÂÆπËØ∑ÂèÇËÄÉ[Serverless Devs Install-tutorial](https://github.com/devsapp/fc/blob/main/docs/Getting-started/Install-tutorial.md)„ÄÇ

### Docker

Êú¨ÊñáÊ°£Ê∂âÂèäÊú¨Âú∞Ë∞ÉËØïÔºåÂõ†Ê≠§ÈúÄË¶ÅÂºÄÂèëÁéØÂ¢ÉÂÖ∑Êúâ[Docker](https://www.docker.com/)ÔºåÊÇ®ÂèØÊ†πÊçÆÊÇ®ÂºÄÂèëÂπ≥Âè∞ÁöÑ‰∏çÂêåÂÆâË£Ö‰∏çÂêåÁâàÊú¨ÔºåÂèØÂèÇËÄÉ[Serverless Devs Install-tutorial](https://github.com/devsapp/fc/blob/main/docs/Getting-started/Install-tutorial.md)ÂèØÈÄâÈÉ®ÂàÜ„ÄÇ

### Aliyun RAM Ë¥¶Âè∑

ÂâçÂæÄ[RAM ËÆøÈóÆÊéßÂà∂](https://ram.console.aliyun.com/users)ÂàõÂª∫‰∏Ä‰∏™Â≠êÁî®Êà∑ÔºåËµã‰∫àÂÖ∂ÁÆ°ÁêÜÂáΩÊï∞ËÆ°ÁÆó (FC) ÊúçÂä°ÊùÉÈôê„ÄåAliyunFCFullAccess„ÄçÂπ∂ÂàõÂª∫ AccessKey„ÄÇ

### Serverless-Devs ÂØÜÈí•ÈÖçÁΩÆ

ÂèÇËÄÉ[ÈÖçÁΩÆÈòøÈáå‰∫ëÂØÜÈí•](https://github.com/devsapp/fc/blob/main/docs/Getting-started/Setting-up-credentials.md)Âèä[S config](http://www.serverless-devs.com/docs/command#configÊåá‰ª§)ÔºåÂ∞Ü‰∏ä‰∏ÄÊ≠•ÂàõÂª∫ÁöÑÂ≠êÁî®Êà∑ AccessKey ÈÖçÁΩÆÂà∞ S ‰∏≠„ÄÇ

## ÂºÄÂèë

### ÂàùÂßãÂåñÈ°πÁõÆ

ÊâßË°å`s init`Êù•ÂàõÂª∫È°πÁõÆÔºåÊàë‰ª¨ÈÄâÊã©*Alibaba Cloud Serverless ‚û°Ô∏è HTTP Function-Node.js 12 Example ‚û°Ô∏è ËæìÂÖ•Êñá‰ª∂Â§πÂêçÁß∞*„ÄÇ

### Ëá™ÂÆö‰πâ Runtime

ÂàõÂª∫ Funfile Êñá‰ª∂Ôºö

```dockerfile
RUNTIME nodejs12	# ÊåáÂÆöÂü∫Á°ÄËøêË°åÁéØÂ¢É
RUN fun-install apt-get install ghostscript
```

Êõ¥Â§öÂÖ≥‰∫é Funfile ‰ø°ÊÅØËØ∑ÂèÇËÄÉ[Funfile ÂäüËÉΩ‰ªãÁªç](https://developer.aliyun.com/article/719100)Âèä[Custom Runtime-ÂáΩÊï∞ËÆ°ÁÆó](https://help.aliyun.com/document_detail/132044.html?spm=a2c4g.11186623.6.601.2cd369ac18G1R7)„ÄÇ

### ‰øÆÊîπ index.js

```javascript
// index.js
const { exec } = require('child_process')

exports.handler = (event, context, callback) => {
  const cmd = 'gs -sDEVICE=jpeg -dTextAlphaBits=4 -r144 -o /tmp/test.jpg test.pdf'
  exec(cmd, (err, stdout, stderr) => {
    if (err) {
      console.log('stdout =================== START')
      console.log(stdout)
      console.log('stdout =================== END')
      console.log('stderr =================== START')
      console.log(stderr)
      console.log('stderr =================== END')
      callback(err, 'convert fail.\n')
    } else {
      console.log('stdout =================== START')
      console.log(stdout)
      console.log('stdout =================== END')
      callback(null, 'convert success.\nJPG file save to /tmp/test.jpg\n')
    }
  })
}
```

### ‰øÆÊîπ s.yaml

Âú® function Â≠óÊÆµ‰∏ãÊ∑ªÂä†ÁéØÂ¢ÉÂèòÈáè

```yaml
# s.yaml
...
services:
  ghostscript_example: #  ÊúçÂä°ÂêçÁß∞
    component: devsapp/fc  # ÁªÑ‰ª∂ÂêçÁß∞

    props: #  ÁªÑ‰ª∂ÁöÑÂ±ûÊÄßÂÄº
      service:
        name: ghostscript
      ...
      function:
        ...
        name: pdf2jpg-test
        environmentVariables:
          GS_LIB: >-
        .s/root/usr/share/ghostscript/9.26/Resource/Init:.s/root/usr/share/ghostscript/9.26/lib:.s/root/usr/share/ghostscript/9.26/Resource/Font:.s/root/usr/share/ghostscript/fonts:.s/root/var/lib/ghostscript/fonts:.s/root/usr/share/ghostscript/fonts:.s/root/usr/share/fonts
```

### Ê∑ªÂä†ÊµãËØïÊñá‰ª∂

Âú®È°πÁõÆÁõÆÂΩï‰∏ãÊ∑ªÂä†‰∏Ä‰∏™Âêç‰∏∫„Äåtest.pdf„ÄçÁöÑÊµãËØïÊñá‰ª∂„ÄÇ

### ÊûÑÂª∫ Runtime Âπ∂ÂÆâË£Ö‰æùËµñ

ÊâßË°å`s build`ÔºåS Ê£ÄÊµãÂà∞È°πÁõÆ‰∏≠Â≠òÂú®„ÄåFunfile„ÄçÊó∂Â∞Ü‰ºö‰ª• Custom Container Ê®°ÂºèÊûÑÂª∫Âπ∂ÂÆâË£Ö‰æùËµñÔºåÂæóÂà∞`Build artifact successfully`Êó∂ËØ¥ÊòéÊûÑÂª∫ÊàêÂäü„ÄÇ

```shell
$ s build
[2021-07-27T08:31:31.428] [INFO ] [S-CLI] - Start ...
[2021-07-27T08:31:33.142] [INFO ] [FC-BUILD] - Build artifact start...
Funfile exist, Fun will use container to build forcely
Step 1/2 : FROM registry.cn-beijing.aliyuncs.com/aliyunfc/runtime-nodejs12:build-1.9.17 as nodejs12
 ---> 231f0fd07c07
Step 2/2 : RUN fun-install apt-get install ghostscript
 ---> Using cache
 ---> f1fd050510fe
sha256:f1fd050510fedf0cbcb673d327c84a153d824357f77fe0f0f76e730b4bbe0a3c
Successfully built f1fd050510fe
Successfully tagged fun-cache-4c2c48e0-2395-45c8-a29d-2c9668b985eb:latest
copying function artifact to /Users/linjiaxiang/ServerlessDevs/ghostscript_example/.s/build/artifacts/ghostscript/pdf2jpg-test
[2021-07-27T08:31:37.020] [INFO ] [FC-BUILD] - Build function using image: fun-cache-4c2c48e0-2395-45c8-a29d-2c9668b985eb
[2021-07-27T08:31:37.033] [INFO ] [FC-BUILD] - skip pulling image fun-cache-4c2c48e0-2395-45c8-a29d-2c9668b985eb...
[2021-07-27T08:31:38.245] [INFO ] [FC-BUILD] - Build artifact successfully.

Tips for next step
======================
* Invoke Event Function: s local invoke
* Invoke Http Function: s local start
* Deploy Resources: s deploy
End of method: build
```

### Êú¨Âú∞Ë∞ÉÁî®

```shell
$ s local invoke
FC Invoke Start RequestId: f6d78602-c84d-41f5-a8be-345825effcd7
load code for handler:index.handler
2021-07-27T00:33:12.019Z f6d78602-c84d-41f5-a8be-345825effcd7 [verbose] stdout =================== START
2021-07-27T00:33:12.019Z f6d78602-c84d-41f5-a8be-345825effcd7 [verbose] GPL Ghostscript 9.26 (2018-11-20)
Copyright (C) 2018 Artifex Software, Inc.  All rights reserved.
This software comes with NO WARRANTY: see the file PUBLIC for details.
Warning: the map file cidfmap was not found.
Processing pages 1 through 1.
Page 1

2021-07-27T00:33:12.020Z f6d78602-c84d-41f5-a8be-345825effcd7 [verbose] stdout =================== END
FC Invoke End RequestId: f6d78602-c84d-41f5-a8be-345825effcd7
convert success.
JPG file save to /tmp/test.jpg
```

ÂèØ‰ª•Êü•ÁúãÊñá‰ª∂`.s/build/artifacts/ghostscript/pdf2jpg-test/test.jpg`Êü•ÁúãÊïàÊûú

### ÈÉ®ÁΩ≤

```shell
$ s deploy
[2021-07-27T08:52:03.419] [INFO ] [S-CLI] - Start ...
[2021-07-27T08:52:05.745] [INFO ] [FC-DEPLOY] - Using region: cn-shenzhen
[2021-07-27T08:52:05.746] [INFO ] [FC-DEPLOY] - Using access alias: ali-main
[2021-07-27T08:52:05.746] [INFO ] [FC-DEPLOY] - Using accessKeyID: ***********1257
[2021-07-27T08:52:05.746] [INFO ] [FC-DEPLOY] - Using accessKeySecret: ***********eMkg
[2021-07-27T08:52:06.188] [INFO ] [FC-DEPLOY] - Checking Service ghostscript exists
[2021-07-27T08:52:06.695] [INFO ] [FC-DEPLOY] - Checking Function pdf2jpg-test exists
üìé Using fc deploy type: sdk, If you want to deploy with pulumi, you can [s cli fc-default set deploy-type pulumi] to switch.
[2021-07-27T08:52:07.710] [INFO ] [FC-DEPLOY] - Fc detects that you have run build command for function: pdf2jpg-test.
...
[2021-07-27T08:52:14.454] [INFO ] [FC-DEPLOY] - Creating service: ghostscript
[2021-07-27T08:52:14.454] [INFO ] [FC-DEPLOY] - Creating function: pdf2jpg-test
‚úî Make service ghostscript success.
‚úî Make function ghostscript/pdf2jpg-test success.
[2021-07-27T08:52:29.186] [INFO ] [FC-DEPLOY] - Checking Service ghostscript exists
[2021-07-27T08:52:29.499] [INFO ] [FC-DEPLOY] - Checking Function pdf2jpg-test exists
...
```

### Ë∞ÉÁî®

```shell
$ s invoke
[2021-07-27T08:52:46.610] [INFO ] [S-CLI] - Start ...
========= FC invoke Logs begin =========
FC Invoke Start RequestId: 8b072a2e-0233-4218-b5f8-9c6385c50933
load code for handler:index.handler
2021-07-27T00:52:49.652Z 8b072a2e-0233-4218-b5f8-9c6385c50933 [verbose] stdout =================== START
2021-07-27T00:52:49.652Z 8b072a2e-0233-4218-b5f8-9c6385c50933 [verbose] GPL Ghostscript 9.26 (2018-11-20)
Copyright (C) 2018 Artifex Software, Inc.  All rights reserved.
This software comes with NO WARRANTY: see the file PUBLIC for details.
Warning: the map file cidfmap was not found.
Processing pages 1 through 1.
Page 1

2021-07-27T00:52:49.652Z 8b072a2e-0233-4218-b5f8-9c6385c50933 [verbose] stdout =================== END
FC Invoke End RequestId: 8b072a2e-0233-4218-b5f8-9c6385c50933

Duration: 669.58 ms, Billed Duration: 670 ms, Memory Size: 128 MB, Max Memory Used: 97.57 MB
========= FC invoke Logs end =========

FC Invoke Result:
convert success.
JPG file save to /tmp/test.jpg

End of method: invoke
```

## ÈôÑÂΩï‰∏éÂèÇËÄÉ

- [Êú¨Êñá‰ª£Á†Å](https://github.com/JasonLamv-t/serverless-devs-ghostscript_example)
- [awesome-fc/ghostscript_example: Âü∫‰∫é GhostScript ÁöÑ PDF ËΩ¨ JPG ](https://github.com/awesome-fc/ghostscript_example)